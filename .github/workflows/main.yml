
name: docker-compose-test-workflow
on: push
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Setup de l'environnement de test
        uses: actions/checkout@v2
      - name: Build the stack
        run: docker-compose -f ./docker-compose-test.yaml up --build
      - name: Check containers
        run: docker ps -a
      - name: Get container ID
        run: echo '::set-output name=CONTAINER_ID::$(docker ps -aqf "name=web_application_tests")'
        id: get-container-id
      - name: Check the exit code
        run: docker inspect ${{ steps.get-container-id.outputs.CONTAINER_ID }} --format='{{.State.ExitCode}}'
